# Обновление многоязычности категорий

## Дата: 4 ноября 2025 г.

## Описание изменений

Добавлена возможность вводить и редактировать наименования категорий запчастей на трёх языках:
- **Русский** (обязательное поле)
- **English** (опционально)
- **עברית** (иврит, опционально)

## Что было изменено

### 1. Frontend (HTML)
**Файл:** `templates/admin/parts.html`

- Обновлено модальное окно для категорий
- Добавлены поля для ввода названий на английском и иврите
- Добавлены визуальные разделители для группировки полей
- Поле на иврите имеет атрибут `dir="rtl"` для правильного отображения

### 2. Frontend (JavaScript)
**Файл:** `static/js/parts-manager.js`

#### Функция `renderCategories()`
- Обновлено отображение категорий в таблице
- Теперь показывает основное название (русское) и переводы под ним
- Формат: "RU: Название | EN: Name | HE: שם"

#### Функция `editCategory(id)`
- Добавлена загрузка и отображение многоязычных полей при редактировании
- Заполняются поля `categoryNameEn` и `categoryNameHe`

#### Функция `saveCategory(event)`
- Обновлена для отправки данных на трёх языках
- Отправляемые поля: `name`, `name_ru`, `name_en`, `name_he`

### 3. Backend (API)
**Файл:** `app.py`

#### Endpoint: `POST /api/admin/categories`
- Добавлена обработка полей `name_ru`, `name_en`, `name_he`
- Валидация: обязательно только поле `name` (русский)
- Английское и ивритское названия опциональны

#### Endpoint: `PUT /api/admin/categories/<int:category_id>`
- Добавлено обновление полей `name_ru`, `name_en`, `name_he`
- Пустые строки конвертируются в `None`
- Сохранена обратная совместимость с полем `name`

### 4. База данных
**Таблица:** `categories`

Используются существующие колонки (добавлены ранее миграцией):
- `name_ru` - VARCHAR(120) - название на русском
- `name_en` - VARCHAR(120) - название на английском
- `name_he` - VARCHAR(120) - название на иврите

## Использование

### Добавление новой категории:
1. Откройте страницу управления запчастями (`/admin/parts`)
2. Нажмите "+ Добавить категорию"
3. Заполните поля:
   - **Название (Русский)** - обязательно
   - **Название (English)** - опционально
   - **Название (עברית)** - опционально
4. Нажмите "Сохранить"

### Редактирование существующей категории:
1. В таблице категорий нажмите кнопку "✏️ Редактировать"
2. Измените названия на нужных языках
3. Нажмите "Сохранить"

### Просмотр категорий:
В таблице категорий отображается:
- Основное название (русское)
- Переводы в серой строке под названием (если заполнены)

## API

### Создание категории
```json
POST /api/admin/categories
{
  "name": "Тормоза",
  "name_ru": "Тормоза",
  "name_en": "Brakes",
  "name_he": "בלמים",
  "sort_order": 0,
  "is_active": true
}
```

### Обновление категории
```json
PUT /api/admin/categories/1
{
  "name": "Тормоза",
  "name_ru": "Тормоза",
  "name_en": "Brakes",
  "name_he": "בלמים",
  "sort_order": 0,
  "is_active": true
}
```

### Получение категории
```json
GET /api/admin/categories/1

Response:
{
  "id": 1,
  "name": "Тормоза",
  "name_ru": "Тормоза",
  "name_en": "Brakes",
  "name_he": "בלמים",
  "is_active": true,
  "sort_order": 0,
  "parts_count": 5,
  "active_parts_count": 5,
  "created_at": "2025-11-04 10:00:00",
  "updated_at": "2025-11-04 10:00:00"
}
```

## Обратная совместимость

- Поле `name` сохранено и синхронизируется с `name_ru`
- Существующие категории без переводов продолжают работать
- API возвращает все поля для админа
- Модель `Category` имеет метод `get_name(lang)` для получения названия на нужном языке

## Тестирование

1. ✅ Создание новой категории с переводами
2. ✅ Редактирование существующей категории
3. ✅ Отображение категорий с переводами в таблице
4. ✅ Сохранение только русского названия (без переводов)
5. ✅ Обновление категории с добавлением переводов

## Следующие шаги

Функционал готов к использованию. Рекомендуется:
1. Заполнить переводы для существующих категорий через админ-панель
2. При создании новых категорий сразу указывать переводы
3. Использовать метод `get_name(lang)` модели для отображения названий на нужном языке в механических интерфейсах

## Связанные файлы

- `models.py` - модель Category уже содержит необходимые поля
- `migrations/add_category_translations.py` - миграция для добавления полей (уже выполнена)
- `templates/admin/parts.html` - интерфейс управления
- `static/js/parts-manager.js` - логика работы с категориями
- `app.py` - API endpoints

---

**Автор:** GitHub Copilot  
**Дата:** 4 ноября 2025 г.
